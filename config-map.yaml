apiVersion: v1
kind: ConfigMap
metadata:
  namespace: kcim
  name: kong-api-gw-config
data:
  kong.conf: |-
    database = off
    nginx_worker_processes = 1
    log_level = debug
    proxy_listen = 0.0.0.0:8000
    admin_listen = 0.0.0.0:8001
    ssl_cert_default =
    ssl_cert_key_default =

  kong.yml: |-
    _format_version: "3.0"

    consumers:
      - username: kcc
        custom_id: kcc
      - username: iamusr
        custom_id: iamusr

    basicauth_credentials:
      - consumer: kcc
        username: kcc
        password: "Kcc@123!"
      - consumer: iamusr
        username: iamusr
        password: "iamusr@123!"

    services:
      # ===== AUTH (9090) =====
      - name: auth-service
        protocol: http
        host: auth-service.kcim.svc.cluster.local
        port: 9090
        path: /api/auth
        routes:
          - name: auth-route
            paths:
              - /api/auth
            strip_path: true

      - name: authen-detail-service
        protocol: http
        host: auth-service.kcim.svc.cluster.local
        port: 9090
        path: /api/auth-detail
        plugins:
          - name: custom-auth
            config:
              authVerifyTokenEndpoint: http://auth-service.kcim.svc.cluster.local:9090/verifyToken
        routes:
          - name: auth-detail-route
            paths:
              - /api/auth-detail
            strip_path: true

      # ... (ส่วนอื่นๆ คงเดิม)

      # ===== ADMIN (9095) =====
      - name: admin-health
        protocol: http
        host: admin-service.kcim.svc.cluster.local
        port: 9095
        path: /actuator
        routes:
          - name: admin-health-route
            paths:
              - /api/admin-health
            strip_path: true
